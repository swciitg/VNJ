diff -Naur --exclude=CVS --exclude='*.o' --exclude='*.a' --exclude='*.so' --exclude='*.elf' --exclude=System.map --exclude=Makefile.d --exclude='*log' --exclude='*log2' --exclude='*~' --exclude='.*~' --exclude='.#*' --exclude='*.bak' --exclude='*.orig' --exclude='*.rej' --exclude='core.[0-9]*' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=vmlinux --exclude=vmlinux.bin linux-2.6.29.ref/arch/mips/lib/archop_cw.c linux-2.6.29/arch/mips/lib/archop_cw.c
--- linux-2.6.29.ref/arch/mips/lib/archop_cw.c	1969-12-31 16:00:00.000000000 -0800
+++ linux-2.6.29/arch/mips/lib/archop_cw.c	2009-11-04 13:25:04.582238119 -0800
@@ -0,0 +1,69 @@
+#include <linux/init.h>
+#include <linux/kernel.h>
+#include <linux/sched.h>
+#include <linux/mm.h>
+#include <linux/bitops.h>
+
+#include <asm/bcache.h>
+#include <asm/bootinfo.h>
+#include <asm/cache.h>
+#include <asm/cacheops.h>
+#include <asm/cpu.h>
+#include <asm/cpu-features.h>
+#include <asm/io.h>
+#include <asm/page.h>
+#include <asm/pgtable.h>
+#include <asm/r4kcache.h>
+#include <asm/system.h>
+#include <asm/mmu_context.h>
+#include <asm/war.h>
+#include <asm/cacheflush.h> /* for run_uncached() */
+
+// those are left un-documented and have many bizarre requirements. read the ASM. loopCnt is cache lines + 2. 
+void mips_memcopy_std(int *p_src, int *p_dst, int loopCnt);
+void mips_memcopy_std_ua(int *p_uasrc, int *p_dst, int loopCnt);
+void mips_memset(int v,int *p_dst, int loopCnt);
+size_t mips_memcmp(int *p_src, int *p_dst, int loopCnt);
+size_t mips_memcmp_ua(int *p_uasrc, int *p_dst, int loopCnt);
+size_t mips_strnlen(int *p_src, int loopCnt); // return non-zero means found
+size_t mips_strnlen_c(int *p_src,int v, int loopCnt); // return non-zero means found
+void mips_hhblend(int *p_src0,int *p_src1, int *p_dst, int loopCnt);
+
+size_t __strnlen_user_nocheck_asm_alt(const char *s, size_t maxlen)
+{
+	char *src=(void *)s;
+	int n=maxlen;
+	int lines;
+
+	// word align src
+
+	while ((n>0)&&((int)src&3)) {
+		if (*src==0)
+			return maxlen-n;
+		n--;
+		src++;
+	}
+	
+	// do as many lines as possible
+
+	lines=n>>5;
+	if (lines>0) {
+		int l;
+		
+		l=lines-mips_strnlen((int *)src,lines-1);
+
+		src+=l<<5; 
+		n-=l<<5;
+	}
+	
+	// finish quietly
+
+	while (n>0) {
+		if (*src==0)
+			return maxlen-n;
+		n--;
+		src++;
+	}
+	
+	return maxlen;
+}
diff -Naur --exclude=CVS --exclude='*.o' --exclude='*.a' --exclude='*.so' --exclude='*.elf' --exclude=System.map --exclude=Makefile.d --exclude='*log' --exclude='*log2' --exclude='*~' --exclude='.*~' --exclude='.#*' --exclude='*.bak' --exclude='*.orig' --exclude='*.rej' --exclude='core.[0-9]*' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=vmlinux --exclude=vmlinux.bin linux-2.6.29.ref/arch/mips/lib/archop_mips.S linux-2.6.29/arch/mips/lib/archop_mips.S
--- linux-2.6.29.ref/arch/mips/lib/archop_mips.S	1969-12-31 16:00:00.000000000 -0800
+++ linux-2.6.29/arch/mips/lib/archop_mips.S	2009-11-04 13:25:04.582238119 -0800
@@ -0,0 +1,71 @@
+#include <asm/asm.h>
+#include <asm/asm-offsets.h>
+#include <asm/regdef.h>
+
+.set noat
+.set noreorder
+	
+/* size_t mips_strnlen(int *p_src, int loopCnt); */
+LEAF(mips_strnlen)
+
+	move	a2, $0
+
+	li	v0, 0x80808080 
+	li	v1, 0xfefefeff # nice trick, google on it
+	
+	pref	0, 0x0(a0)	# bring the first line of src
+	pref	0, 0x20(a0)	# bring the first line of src
+	pref	0, 0x40(a0)	# bring the first line of src
+1:
+	pref	0, 0x60(a0)	# bring the next lines of src
+
+	lw 	t0, 0x0(a0)
+	addu	t0, v1
+	and	t0, v0
+	addu	a2, t0
+
+	lw 	t1, 0x4(a0)
+	addu	t1, v1
+	and	t1, v0
+	addu	a2, t1
+
+	lw 	t2, 0x8(a0)
+	addu	t2, v1
+	and	t2, v0
+	addu	a2, t2
+
+	lw 	t3, 0xc(a0)
+	addu	t3, v1
+	and	t3, v0
+	addu	a2, t3
+
+	lw 	t0, 0x10(a0)
+	addu	t0, v1
+	and	t0, v0
+	addu	a2, t0
+
+	lw 	t1, 0x14(a0)
+	addu	t1, v1
+	and	t1, v0
+	addu	a2, t1
+
+	lw 	t2, 0x18(a0)
+	addu	t2, v1
+	and	t2, v0
+	addu	a2, t2
+
+	lw 	t3, 0x1c(a0)
+	addu	t3, v1
+	and	t3, v0
+	addu	a2, t3
+
+	bnez	a2, 2f
+	addu	a0, 0x20
+
+	bnez	a1, 1b
+	subu    a1, 1
+
+2:	
+	jr	ra
+	addu	v0, a1, 1
+END(mips_strnlen)
diff -Naur --exclude=CVS --exclude='*.o' --exclude='*.a' --exclude='*.so' --exclude='*.elf' --exclude=System.map --exclude=Makefile.d --exclude='*log' --exclude='*log2' --exclude='*~' --exclude='.*~' --exclude='.#*' --exclude='*.bak' --exclude='*.orig' --exclude='*.rej' --exclude='core.[0-9]*' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=vmlinux --exclude=vmlinux.bin linux-2.6.29.ref/arch/mips/lib/Makefile linux-2.6.29/arch/mips/lib/Makefile
--- linux-2.6.29.ref/arch/mips/lib/Makefile	2009-11-04 13:20:12.000000000 -0800
+++ linux-2.6.29/arch/mips/lib/Makefile	2009-11-04 13:25:04.582238119 -0800
@@ -5,6 +5,8 @@
 lib-y	+= csum_partial.o memcpy.o memcpy-inatomic.o memset.o strlen_user.o \
 	   strncpy_user.o strnlen_user.o uncached.o
 
+obj-$(CONFIG_TANGO3) += archop_mips.o archop_cw.o
+
 obj-y			+= iomap.o
 obj-$(CONFIG_PCI)	+= iomap-pci.o
 
diff -Naur --exclude=CVS --exclude='*.o' --exclude='*.a' --exclude='*.so' --exclude='*.elf' --exclude=System.map --exclude=Makefile.d --exclude='*log' --exclude='*log2' --exclude='*~' --exclude='.*~' --exclude='.#*' --exclude='*.bak' --exclude='*.orig' --exclude='*.rej' --exclude='core.[0-9]*' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=vmlinux --exclude=vmlinux.bin linux-2.6.29.ref/arch/mips/lib/memcpy.S linux-2.6.29/arch/mips/lib/memcpy.S
--- linux-2.6.29.ref/arch/mips/lib/memcpy.S	2009-11-04 13:20:12.000000000 -0800
+++ linux-2.6.29/arch/mips/lib/memcpy.S	2009-11-04 13:25:04.582238119 -0800
@@ -232,10 +232,21 @@
 	 SRL	t0, len, LOG_NBYTES+3    # +3 for 8 units/iter
 	beqz	t0, .Lcleanup_both_aligned # len < 8*NBYTES
 	 and	rem, len, (8*NBYTES-1)	 # rem = len % (8*NBYTES)
+#if !defined(CONFIG_TANGO3)
 	PREF(	0, 3*32(src) )
 	PREF(	1, 3*32(dst) )
 	.align	4
+#else
+	# len>=32, but is it <64?
+	SUB     t0, len, 64
+	bltz    t0, 2f
+	SUB     len, 32
+#endif
 1:
+#if defined(CONFIG_TANGO3)
+	pref    0,  0x60(src)
+	pref    30, 0x20(dst) # we assume dst is 0x20-aligned, not sure
+#endif
 	R10KCBARRIER(0(ra))
 EXC(	LOAD	t0, UNIT(0)(src),	.Ll_exc)
 EXC(	LOAD	t1, UNIT(1)(src),	.Ll_exc_copy)
@@ -256,11 +267,35 @@
 EXC(	STORE	t7, UNIT(-3)(dst),	.Ls_exc_p3u)
 EXC(	STORE	t0, UNIT(-2)(dst),	.Ls_exc_p2u)
 EXC(	STORE	t1, UNIT(-1)(dst),	.Ls_exc_p1u)
+#if !defined(CONFIG_TANGO3)
 	PREF(	0, 8*32(src) )
 	PREF(	1, 8*32(dst) )
+#endif
 	bne	len, rem, 1b
 	 nop
 
+#if defined(CONFIG_TANGO3)
+2:
+EXC(    LOAD    t0, UNIT(0)(src),       .Ll_exc)
+EXC(    LOAD    t1, UNIT(1)(src),       .Ll_exc_copy)
+EXC(    LOAD    t2, UNIT(2)(src),       .Ll_exc_copy)
+EXC(    LOAD    t3, UNIT(3)(src),       .Ll_exc_copy)
+EXC(    LOAD    t4, UNIT(4)(src),       .Ll_exc_copy)
+EXC(    LOAD    t7, UNIT(5)(src),       .Ll_exc_copy)
+EXC(    STORE   t0, UNIT(0)(dst),       .Ls_exc_p8u)
+EXC(    STORE   t1, UNIT(1)(dst),       .Ls_exc_p7u)
+EXC(    LOAD    t0, UNIT(6)(src),       .Ll_exc_copy)
+EXC(    LOAD    t1, UNIT(7)(src),       .Ll_exc_copy)
+        ADD     src, src, 8*NBYTES
+        ADD     dst, dst, 8*NBYTES
+EXC(    STORE   t2, UNIT(-6)(dst),      .Ls_exc_p6u)
+EXC(    STORE   t3, UNIT(-5)(dst),      .Ls_exc_p5u)
+EXC(    STORE   t4, UNIT(-4)(dst),      .Ls_exc_p4u)
+EXC(    STORE   t7, UNIT(-3)(dst),      .Ls_exc_p3u)
+EXC(    STORE   t0, UNIT(-2)(dst),      .Ls_exc_p2u)
+EXC(    STORE   t1, UNIT(-1)(dst),      .Ls_exc_p1u)
+#endif
+
 	/*
 	 * len == rem == the number of bytes left to copy < 8*NBYTES
 	 */
diff -Naur --exclude=CVS --exclude='*.o' --exclude='*.a' --exclude='*.so' --exclude='*.elf' --exclude=System.map --exclude=Makefile.d --exclude='*log' --exclude='*log2' --exclude='*~' --exclude='.*~' --exclude='.#*' --exclude='*.bak' --exclude='*.orig' --exclude='*.rej' --exclude='core.[0-9]*' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=vmlinux --exclude=vmlinux.bin linux-2.6.29.ref/arch/mips/lib/memset.S linux-2.6.29/arch/mips/lib/memset.S
--- linux-2.6.29.ref/arch/mips/lib/memset.S	2009-06-16 04:17:03.000000000 -0700
+++ linux-2.6.29/arch/mips/lib/memset.S	2009-11-04 13:25:04.582238119 -0800
@@ -101,14 +101,28 @@
 	beqz		t1, .Lmemset_partial	/* no block to fill */
 	 andi		t0, a2, 0x40-LONGSIZE
 
+#if defined(CONFIG_TANGO3)
+	subu    t1, 0x40 # distinguish one or >=2 blocks: pref 30 is destructive
+	beqz    t1, 2f
+#endif
+
 	PTR_ADDU	t1, a0			/* end address */
 	.set		reorder
 1:	PTR_ADDIU	a0, 64
+#if defined(CONFIG_TANGO3)
+	pref 30, 0(a0) # we assume a0 is 0x20-aligned
+	pref 30, 32(a0)
+#endif
 	R10KCBARRIER(0(ra))
 	f_fill64 a0, -64, a1, .Lfwd_fixup
 	bne		t1, a0, 1b
 	.set		noreorder
 
+#if defined(CONFIG_TANGO3)
+2:	PTR_ADDIU       a0, 64
+	f_fill64 a0, -64, a1, .Lfwd_fixup
+#endif
+
 .Lmemset_partial:
 	R10KCBARRIER(0(ra))
 	PTR_LA		t1, 2f			/* where to start */
diff -Naur --exclude=CVS --exclude='*.o' --exclude='*.a' --exclude='*.so' --exclude='*.elf' --exclude=System.map --exclude=Makefile.d --exclude='*log' --exclude='*log2' --exclude='*~' --exclude='.*~' --exclude='.#*' --exclude='*.bak' --exclude='*.orig' --exclude='*.rej' --exclude='core.[0-9]*' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=.depend --exclude='.*.o.flags' --exclude='*.gz' --exclude=vmlinux --exclude=vmlinux.bin linux-2.6.29.ref/README.1021.memop.patch linux-2.6.29/README.1021.memop.patch
--- linux-2.6.29.ref/README.1021.memop.patch	1969-12-31 16:00:00.000000000 -0800
+++ linux-2.6.29/README.1021.memop.patch	2009-11-04 13:26:33.792427368 -0800
@@ -0,0 +1,21 @@
+Feature:
+--------
+Optimized memory copy/set operations for MIPS 24K/74K/1004K 
+(bug#10799)
+
+Prerequisite patch numbers:
+---------------------------
+0000
+1000
+1001
+
+Primary author:
+---------------
+Emmanuel Michon
+
+Related to which chip version SMP86xx xx=?
+-----------------------------------------
+Tango3 ES3 or above
+
+(linux patches) which CONFIG_... are provided:
+----------------------------------------------
